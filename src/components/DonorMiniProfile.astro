---
// Â© Vlad-Stefan Harbuz <vlad@vlad.website>
// SPDX-License-Identifier: Apache-2.0

import { Image } from 'astro:assets';

interface Props {
  name: string;
  description?: string;
  avatarUrl?: string;
  hasPhoto?: boolean;
  compact?: boolean;
  extraClasses?: string;
}

const { name, description, avatarUrl, hasPhoto, compact, extraClasses } = Astro.props;

const showInitials = hasPhoto && !avatarUrl;
const initials = name.split(/\s+/).map(w => w[0]).slice(0, 2).join('').toUpperCase();

const AVATAR_BG_COLORS = [
    '#4a90d9', '#d94a4a', '#50b87a', '#e0a030', '#9b59b6', '#1abc9c', '#e67e22', '#3498db', '#e74c3c', '#2ecc71'
];
let hash = 0;
for (const c of name) {
    hash = ((hash << 5) - hash + c.charCodeAt(0)) | 0;
}
const avatarBgColor = AVATAR_BG_COLORS[Math.abs(hash) % AVATAR_BG_COLORS.length];
---

<div class={'donor-mini-profile' + (compact ? ' donor-mini-profile--compact' : '') + (extraClasses ? ' ' + extraClasses : '')}>
    {!compact && (avatarUrl || showInitials) &&
        <div class="donor-avatar">
            {avatarUrl ? (
                <Image src={avatarUrl} alt={name + " photo"} width={96} height={96} loading="lazy" />
            ) : (
                <div class="donor-initials" style={`background-color: ${avatarBgColor}`}>
                    {initials}
                </div>
            )}
        </div>
    }
    <div>
        <h3>{name}</h3>
        {!compact &&
            <i>{description}</i>
        }
    </div>
</div>

<style>
    .donor-initials {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        border-radius: var(--border-radius);
        color: #fff;
        font-weight: 600;
        font-size: 1.1rem;
        line-height: 1;
        user-select: none;
    }
</style>
